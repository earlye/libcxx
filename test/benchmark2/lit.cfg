# -*- Python -*- vim: set ft=python ts=4 sw=4 expandtab tw=79:
# Configuration file for the 'lit' test runner.
import os
import site
import sys

site.addsitedir(os.path.join(os.path.dirname(__file__), '..'))
import libcxx.test.config
import lit.formats.benchmarktest

# Tell pylint that we know config and lit_config exist somewhere.
if 'PYLINT_IMPORT' in os.environ:
    config = object()
    lit_config = object()

# name: The name of this test suite.
config.name = 'libc++-benchmark'

config.suffixes = ['.bench.exe']

# Infer the test_exec_root from the libcxx_object root.
obj_root = getattr(config, 'libcxx_obj_root', None)

# Check that the test exec root is known.
if obj_root is None:
    import libcxx.test.config
    libcxx.test.config.loadSiteConfig(
        lit_config, config, 'libcxx_site_config', 'LIBCXX_SITE_CONFIG')
    obj_root = getattr(config, 'libcxx_obj_root', None)
    if obj_root is None:
        lit_config.fatal('Failed to find tests...')

config.test_exec_root = os.path.join(obj_root, 'test', 'benchmark2')

# test_source_root: The root path where tests are located.
config.test_source_root = config.test_exec_root

config.test_format = lit.formats.benchmarktest.BenchmarkTest(
    ['--benchmark_repetitions=5'])

